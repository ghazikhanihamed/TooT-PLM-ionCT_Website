<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein Sequence Prediction</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <h1>Protein Function Prediction - TooT-PLM-ionCT</h1>
        <section id="system-description">
            <h2>About TooT-PLM-ionCT</h2>
            <p>
                TooT-PLM-ionCT is a composite framework designed for the specific tasks of segregating ion channels
                (ICs)
                and ion transporters (ITs) from other membrane proteins, and differentiating ICs from ITs. This
                framework
                leverages six diverse Protein Language Models (PLMs) including ProtBERT, ProtBERT-BFD, ESM-1b, and ESM-2
                variants, to predict protein functions effectively. Given the crucial role of these proteins in
                regulating
                ion movement across cellular membranes, TooT-PLM-ionCT aims to facilitate understanding of their
                functions
                without the need for time-consuming wet lab experiments. The system employs a combination of
                conventional
                and deep learning models to achieve superior performance in classifying ITs and distinguishing between
                ICs
                and ITs, contributing significantly to the field of bioinformatics.
            </p>
        </section>
        <div>
            <h3>Submit Your Protein Sequence</h3>
            <p>Please enter a single protein sequence in the field below. Our system is currently designed to process
                one
                sequence at a time to ensure accurate and efficient predictions.</p>
        </div>
        <div>
            <label for="classificationType">Select Classification Type:</label>
            <select id="classificationType" name="classificationType">
                <option value="IC_MP">Ion Channels - Membrane Proteins</option>
                <option value="IT_MP">Ion Transporters - Membrane Proteins</option>
                <option value="IC_IT">Ion Channels - Ion Transporters</option>
            </select>
        </div>
        <div>
            <label for="proteinSequence">Enter Protein Sequence:</label>
            <textarea id="proteinSequence" name="proteinSequence" pattern="[ACDEFGHIKLMNPQRSTVWY]+" required></textarea>
            <button onclick="submitSequence()">Submit Sequence</button>
        </div>
        <!-- Loading Section -->
        <div id="loadingSection" style="display:none;">
            <img src="/static/images/loading.gif" alt="Processing..." />
            <p>Processing your sequence, please wait...</p>
        </div>
        <!-- Results Section -->
        <div id="resultsSection" style="display:none;">
            <h3>Prediction Results</h3>
            <p id="resultsText">Your results will appear here.</p>
        </div>
    </div>

    <footer>
        <p>&copy; <span id="year"></span> Bioinformatics Lab, Computer Science Department, Concordia University</p>
        <p>Developed by Hamed Ghazikhani</p>
    </footer>

    <script>
        function submitSequence() {
            var sequenceElement = document.getElementById('proteinSequence');
            var rawSequence = sequenceElement.value;
            var sequence = rawSequence.replace(/^>.*\n?/, '').replace(/\s+/g, '');
            var regexPattern = /^[ACDEFGHIKLMNPQRSTVWY]+$/i;

            if (!regexPattern.test(sequence)) {
                alert("Invalid protein sequence. Please enter a valid sequence consisting of amino acid letters.");
                return;
            }

            // Display the loading section
            document.getElementById('loadingSection').style.display = 'block';
            // Hide the results section in case it's already visible from a previous submission
            document.getElementById('resultsSection').style.display = 'none';

            var classificationType = document.getElementById('classificationType').value;
            fetch('/submit_sequence', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'proteinSequence=' + encodeURIComponent(sequence) + '&classificationType=' + encodeURIComponent(classificationType)
            })
                .then(response => {
                    // Hide the loading section regardless of the response
                    document.getElementById('loadingSection').style.display = 'none';
                    if (!response.ok) {
                        return response.json().then(err => { throw err; });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                    } else {
                        // Display results
                        document.getElementById('resultsText').innerText = 'Prediction: ' + data.prediction;
                        document.getElementById('resultsSection').style.display = 'block';
                    }
                })
                .catch(error => {
                    // Hide the loading section in case of an error
                    document.getElementById('loadingSection').style.display = 'none';
                    alert('Error: ' + (error.error || error.message));
                });
        }

        document.getElementById('year').textContent = new Date().getFullYear();
    </script>

</body>

</html>